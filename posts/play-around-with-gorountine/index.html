<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Play around with goroutine</title>
	<meta name="description" content="khanhtc personal&#39;s note">
	<meta name="author" content="khanhtc">
	
		<link rel="preconnect" href="https://cse.google.com">
		<link rel="preconnect" href="https://www.googleapis.com">
		<link rel="preconnect" href="https://www.google.com">
		<link rel="preconnect" href="https://clients1.google.com">
	
	
		<link rel="preconnect" href="https://cdn.mathjax.org">
	
	
</head>
<body>
	<header id="header">
	<a href="https://khanhtc1202.github.io/">khanhtc&#39;s blog</a> | ğŸ“£ <a href="https://khanhtc1202.github.io/index.xml">RSS</a> | ğŸ‘€ <a href="https://khanhtc1202.github.io/alive">Liveness check</a>
	<div class="gcse-search"></div>
	
	<nav>
		<ul>
			
			<li><a href="/about">about</a></li>
			
			<li><a href="https://github.com/khanhtc1202">github</a></li>
			
			<li><a href="https://leetcode.com/khanhtc">leetcode</a></li>
			
			<li><a href="https://www.linkedin.com/in/khanhtc1202">linkedin</a></li>
			
		</ul>
	</nav>
	
</header>

	
	<main>
		<article>
			<h1>Play around with goroutine</h1>
			<time>21.07.2018 18:59</time>
			<div>
				<p>HÃ´m nay trong lÃºc lÆ°á»£n lá» <a href="https://tour.golang.org/list">go tour</a> - má»™t guide khÃ¡ Ä‘áº§y Ä‘á»§ vÃ  thÃº vá»‹ giá»›i thiá»‡u vá» golang, mÃ¬nh báº¯t gáº·p má»™t Ä‘oáº¡n khÃ¡ thÃº vá»‹ :))</p>
<!-- more -->
<p>Trong má»¥c concurrency in golang, giá»›i thiá»‡u vá» goroutine - má»™t Ä‘iá»ƒm ráº¥t máº¡nh cá»§a golang dÃ¹ng thay tháº¿ cho thread trong cÃ¡c ngÃ´n ngá»¯ láº­p trÃ¬nh khÃ¡c - item 7 cÃ³ nháº¯c láº¡i kiáº¿n thá»©c vá» tree. Trong Ä‘Ã³ cÃ³ Ä‘Æ°a ra 1 quiz nhá» nhÆ° sau:</p>
<blockquote>
<p>There can be many different binary trees with the same sequence of values stored at the leaves. For example, here are two binary trees storing the sequence 1, 1, 2, 3, 5, 8, 13.</p>
</blockquote>
<p><img src="https://tour.golang.org/content/img/tree.png" alt=""></p>
<blockquote>
<p>A function to check whether two binary trees store the same sequence is quite complex in most languages. We&rsquo;ll use Go&rsquo;s concurrency and channels to write a simple solution.</p>
</blockquote>
<p>Má»™t quiz nghe cÃ³ váº» Ä‘Æ¡n giáº£n nhÆ°ng khi implement báº±ng má»™t ngÃ´n ngá»¯ má»›i vá»›i cÃ´ng cá»¥ má»›i nÃ³ cÅ©ng Ä‘em Ä‘áº¿n nhiá»u gÃ³c nhÃ¬n khÃ¡ thÃº vá»‹ :))</p>
<p>Äá»ƒ giáº£i quiz nÃ y, cÃ´ng cá»¥ chÃºng ta cáº§n lÃ  má»™t phÃ©p duyá»‡t tree, ráº¥t tá»± nhiÃªn, phÃ©p duyá»‡t Ä‘Æ°á»£c chá»n Ä‘á»ƒ dÃ¹ng trong trÆ°á»ng há»£p nÃ y lÃ  <strong>duyá»‡t thá»© tá»± trÆ°á»›c</strong> hay <code>LNR</code> (má»™t lÃ½ do khÃ¡c Ä‘á»ƒ chá»n phÃ©p duyá»‡t nÃ y lÃ  hint cá»§a quiz cÅ©ng gá»£i Ã½ dÃ¹ng phÃ©p nÃ y :)) )</p>
<p>Theo suy nghÄ© thÃ´ng thÆ°á»ng, ta cÃ³ implement cá»§a phÃ©p duyá»‡t LNR Ä‘Æ¡n giáº£n nhÆ° sau</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C" data-lang="C"><span style="display:flex;"><span><span style="color:#888;font-weight:bold">void</span> <span style="color:#06b;font-weight:bold">LNR</span>(Tree T) {
</span></span><span style="display:flex;"><span>	<span style="color:#080;font-weight:bold">if</span> (T!=<span style="color:#038">NULL</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#06b;font-weight:bold">LNR</span>(T-&gt;Left);
</span></span><span style="display:flex;"><span>		<span style="color:#06b;font-weight:bold">printf</span>(<span style="color:#d20;background-color:#fff0f0">&#34;%d &#34;</span>, T-&gt;value);
</span></span><span style="display:flex;"><span>		<span style="color:#06b;font-weight:bold">LNR</span>(T-&gt;Right);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Do quiz yÃªu cáº§u sá»­ dá»¥ng <code>goroutine</code> - káº¿t quáº£ tráº£ vá» tá»« goroutine cho main (cÃ³ thá»ƒ coi cÅ©ng lÃ  1 goroutine khÃ¡c) thÃ´ng qua <code>channel</code> (cÃ¡c khÃ¡i niá»‡m Ä‘Ã£ nháº¯c Ä‘áº¿n trÃªn Ä‘á»u Ä‘Æ°á»£c giáº£i thÃ­ch ráº¥t chi tiáº¿t trong <a href="https://tour.golang.org/list">go tour</a> do Ä‘Ã³ khÃ´ng Ä‘Æ°á»£c nháº¯c láº¡i trong bÃ i viáº¿t ná»¯a). Tá»« Ä‘Ã³ ta cÃ³ implement Ä‘Æ¡n giáº£n nhÆ° sau:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#080;font-weight:bold">func</span> <span style="color:#06b;font-weight:bold">WalkRecursion</span>(t *tree.Tree, ch <span style="color:#080;font-weight:bold">chan</span> <span style="color:#888;font-weight:bold">int</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#080;font-weight:bold">if</span> t != <span style="color:#080;font-weight:bold">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#06b;font-weight:bold">WalkRecursion</span>(t.Left, ch)
</span></span><span style="display:flex;"><span>		ch &lt;- t.Value
</span></span><span style="display:flex;"><span>		<span style="color:#06b;font-weight:bold">WalkRecursion</span>(t.Right, ch)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#080;font-weight:bold">func</span> <span style="color:#06b;font-weight:bold">main</span>() {
</span></span><span style="display:flex;"><span>	ch := <span style="color:#038">make</span>(<span style="color:#080;font-weight:bold">chan</span> <span style="color:#888;font-weight:bold">int</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#080;font-weight:bold">go</span> <span style="color:#06b;font-weight:bold">WalkRecursion</span>(tree.<span style="color:#06b;font-weight:bold">New</span>(<span style="color:#00d;font-weight:bold">1</span>), ch)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#080;font-weight:bold">for</span> i := <span style="color:#080;font-weight:bold">range</span> ch {
</span></span><span style="display:flex;"><span>		fmt.<span style="color:#06b;font-weight:bold">Printf</span>(<span style="color:#d20;background-color:#fff0f0">&#34;%d, &#34;</span>,i)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Compile vÃ  cháº¡y Ä‘oáº¡n trÃªn ta dÃ­nh lá»—i sau:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>fatal error: all goroutines are asleep - deadlock!
</span></span></code></pre></div><p>Sá»Ÿ dÄ© cÃ³ lá»—i trÃªn lÃ  do vÃ²ng <code>for</code> Ä‘oáº¡n in káº¿t quáº£ trong hÃ m main lÃ  infinite loop, nguyÃªn nhÃ¢n do <code>for i := range ch</code> chá»‰ dá»«ng khi channel <code>ch</code> Ä‘Æ°á»£c Ä‘Ã³ng - trong khi trong Ä‘oáº¡n implement trÃªn mÃ¬nh chÆ°a thá»±c hiá»‡n <code>close(ch)</code> :v</p>
<p>Sá»­ dá»¥ng <code>defer</code> Ä‘á»ƒ close lÃ  khÃ´ng hiá»‡u quáº£, lÃ½ do chÃ­nh vÃ¬ defer trong scope cá»§a main sáº½ Ä‘á»£i for loop káº¿t thÃºc :)) (má»™t trick khÃ¡c cÅ©ng liÃªn quan chÃºt Ã­t Ä‘áº¿n váº¥n Ä‘á» nÃ y cÃ³ thá»ƒ tÃ¬m tháº¥y trong post <a href="https://kipalog.com/posts/2-cach-de-lam-memory-leak-trong-golang">nÃ y</a> )</p>
<p>NghÄ© má»™t cÃ¡ch Ä‘Æ¡n giáº£n hÆ¡n, ta chá»‰ cáº§n close channel táº¡i thá»i Ä‘iá»ƒm <code>WalkRecursion</code> Ä‘Ã£ cháº¡y xong lÃ  Ä‘Æ°á»£c! Hay nÃ³i cÃ¡ch khÃ¡c - Ä‘Ã³ng channel tráº£ vá» dá»¯ liá»‡u táº¡i thá»i Ä‘iá»ƒm hÃ m push dá»¯ liá»‡u (supplier) Ä‘Ã£ cháº¡y xong. VÃ  Ä‘á»ƒ lÃ m Ä‘Æ°á»£c Ä‘iá»u Ä‘Ã³, táº¥t nhiÃªn ta sáº½ lÃ m á»Ÿ goroutine cÃ³ supplier Ä‘ang cháº¡y :D</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#080;font-weight:bold">func</span> <span style="color:#06b;font-weight:bold">main</span>() {
</span></span><span style="display:flex;"><span>	ch := <span style="color:#038">make</span>(<span style="color:#080;font-weight:bold">chan</span> <span style="color:#888;font-weight:bold">int</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#080;font-weight:bold">go</span> <span style="color:#080;font-weight:bold">func</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#06b;font-weight:bold">WalkRecursion</span>(tree.<span style="color:#06b;font-weight:bold">New</span>(<span style="color:#00d;font-weight:bold">1</span>), ch)
</span></span><span style="display:flex;"><span>		<span style="color:#038">close</span>(ch)
</span></span><span style="display:flex;"><span>	}()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#080;font-weight:bold">for</span> i := <span style="color:#080;font-weight:bold">range</span> ch {
</span></span><span style="display:flex;"><span>		fmt.<span style="color:#06b;font-weight:bold">Printf</span>(<span style="color:#d20;background-color:#fff0f0">&#34;%d, &#34;</span>,i)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Äoáº¡n code trÃªn Ä‘Ã£ cháº¡y ngon :)) tuy nhiÃªn nhÃ¬n hÆ¡i&hellip;náº·ng ná», cÃ³ láº½ do trong hint cá»§a quiz cÅ©ng chá»‰ ghi dÃ¹ng <code>go Walk(tree.New(1), ch)</code> Ä‘á»ƒ <code>kick off</code> hÃ m duyá»‡t cÃ¢y. Äá»ƒ Ä‘áº¡t Ä‘Æ°á»£c yÃªu cáº§u Ä‘Ã³, ta sáº½ Ä‘i giáº¥u pháº§n close channel vÃ o trong hÃ m duyá»‡t! Ta cÃ³ thá»ƒ viáº¿t láº¡i hÃ m duyá»‡t tree nhÆ° sau:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#080;font-weight:bold">func</span> <span style="color:#06b;font-weight:bold">WalkEmbedded</span>(t *tree.Tree, ch <span style="color:#080;font-weight:bold">chan</span> <span style="color:#888;font-weight:bold">int</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#080;font-weight:bold">defer</span> <span style="color:#038">close</span>(ch)
</span></span><span style="display:flex;"><span>	<span style="color:#080;font-weight:bold">var</span> walk <span style="color:#080;font-weight:bold">func</span>(t *tree.Tree)
</span></span><span style="display:flex;"><span>	walk = <span style="color:#080;font-weight:bold">func</span>(t *tree.Tree) {
</span></span><span style="display:flex;"><span>		<span style="color:#080;font-weight:bold">if</span> t == <span style="color:#080;font-weight:bold">nil</span> { <span style="color:#080;font-weight:bold">return</span> }
</span></span><span style="display:flex;"><span>		<span style="color:#06b;font-weight:bold">walk</span>(t.Left)
</span></span><span style="display:flex;"><span>		ch &lt;- t.Value
</span></span><span style="display:flex;"><span>		<span style="color:#06b;font-weight:bold">walk</span>(t.Right)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#06b;font-weight:bold">walk</span>(t)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#080;font-weight:bold">func</span> <span style="color:#06b;font-weight:bold">main</span>() {
</span></span><span style="display:flex;"><span>	ch := <span style="color:#038">make</span>(<span style="color:#080;font-weight:bold">chan</span> <span style="color:#888;font-weight:bold">int</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#080;font-weight:bold">go</span> <span style="color:#06b;font-weight:bold">WalkEmbedded</span>(tree.<span style="color:#06b;font-weight:bold">New</span>(<span style="color:#00d;font-weight:bold">1</span>), ch)
</span></span><span style="display:flex;"><span>	...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>P/S: Sau khi ngÃ³ nghÃ­a chÃ¡n Ä‘á»‘ng quiz rá»“i mÃ¬nh má»›i phÃ¡t hiá»‡n ra cÃ³ public solutions cá»§a golang team trÃªn github :&rsquo;( . Tham kháº£o thÃªm solutions cá»§a golang team táº¡i <a href="https://github.com/golang/tour/tree/master/solutions">Ä‘Ã¢y</a>.</p>

			</div>
			
			<div>
				<ul id="tags">
					
					<li><a href="/tags/tree">tree</a></li>
					
					<li><a href="/tags/golang">golang</a></li>
					
				</ul>
			</div>
			
		</article>
	</main>
<aside>
	<div>
		<div>
			<h3>LATEST POSTS</h3>
		</div>
		<div>
			<ul>
				
				<li><a href="/posts/kadane-and-its-applications/">From subarray problems to Kadane and applications</a></li>
				
				<li><a href="/posts/an-approach-for-dp-problem/">An Approach for DP Problem</a></li>
				
				<li><a href="/posts/some-thought-about-tactics/">A breakthrough of my mind</a></li>
				
				<li><a href="/posts/concurrent-unit/">Process, Thread and Routine</a></li>
				
				<li><a href="/posts/complexity-classes/">Complexity Classes</a></li>
				
			</ul>
		</div>
	</div>
</aside>

<aside>
	<div>
    		
			<div>
				<h3>TAGS</h3>
			</div>
			<div>
				<ul>
					
					<li><a href="/tags/algorithm">algorithm</a></li>
					
					<li><a href="/tags/approx">approx</a></li>
					
					<li><a href="/tags/architecture">architecture</a></li>
					
					<li><a href="/tags/c/c&#43;&#43;">c/c&#43;&#43;</a></li>
					
					<li><a href="/tags/code">code</a></li>
					
					<li><a href="/tags/compiler">compiler</a></li>
					
					<li><a href="/tags/concurrent">concurrent</a></li>
					
					<li><a href="/tags/database">database</a></li>
					
					<li><a href="/tags/design">design</a></li>
					
					<li><a href="/tags/dev%20tool">dev tool</a></li>
					
					<li><a href="/tags/golang">golang</a></li>
					
					<li><a href="/tags/javascript">javascript</a></li>
					
					<li><a href="/tags/lock">lock</a></li>
					
					<li><a href="/tags/manual">manual</a></li>
					
					<li><a href="/tags/memory">memory</a></li>
					
					<li><a href="/tags/networks">networks</a></li>
					
					<li><a href="/tags/nodejs">nodejs</a></li>
					
					<li><a href="/tags/oop">oop</a></li>
					
					<li><a href="/tags/os">os</a></li>
					
					<li><a href="/tags/package%20manager">package manager</a></li>
					
					<li><a href="/tags/programming">programming</a></li>
					
					<li><a href="/tags/react">react</a></li>
					
					<li><a href="/tags/tactics">tactics</a></li>
					
					<li><a href="/tags/thinking">thinking</a></li>
					
					<li><a href="/tags/tree">tree</a></li>
					
					<li><a href="/tags/trick">trick</a></li>
					
				</ul>
			</div>
		
	</div>
</aside>



	<footer id="footer">
	<p>&copy; 2017-2024 <a href="https://khanhtc1202.github.io/">khanhtc&#39;s blog</a> | <a href="https://khanhtc1202.github.io/index.xml">RSS</a></p>
	<section><script async src="https://cse.google.com/cse.js?cx=009971123916912295303:lpg9aljzbui"></script>

	</section>
</footer>

</body>
</html>
